---
import CatalogLayout from './CatalogLayout.astro';
import type { ToolData } from '../lib/types';

interface Props {
  tool: ToolData;
}

const { tool } = Astro.props;
const siteUrl = Astro.site?.toString() || 'https://ai-catalog.ru';

// Schema.org JSON-LD - Product
const schemaOrg = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: tool.title,
  description: tool.shortDescription,
  image: new URL(tool.coverImage || '/images/placeholder.svg', siteUrl).toString(),
  url: new URL(`/tool/${tool.slug}`, siteUrl).toString(),
  ...(tool.rating !== undefined && {
    aggregateRating: {
      '@type': 'AggregateRating',
      ratingValue: tool.rating,
      bestRating: 5,
      worstRating: 0,
      ratingCount: 1
    }
  }),
  offers: {
    '@type': 'Offer',
    price: tool.priceModel === 'free' ? '0' : undefined,
    priceCurrency: 'USD',
    availability: 'https://schema.org/InStock'
  }
};

// Schema.org JSON-LD - FAQPage (if FAQ exists)
const faqSchema = tool.faq && tool.faq.length > 0 ? {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: tool.faq.map(item => ({
    '@type': 'Question',
    name: item.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: item.answer
    }
  }))
} : null;
---

<CatalogLayout
  title={tool.title}
  description={tool.shortDescription}
  ogImage={tool.coverImage}
  canonicalUrl={`${siteUrl}/tool/${tool.slug}`}
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(schemaOrg)} />
    {faqSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    )}
  </Fragment>

  <slot />
</CatalogLayout>
