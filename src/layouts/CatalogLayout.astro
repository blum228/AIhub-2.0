---
import { getCollection } from 'astro:content';
import BaseLayout from './BaseLayout.astro';
import Wrapper from '../components/Wrapper.astro';
import Space from '../components/Space.astro';
import SafeModeToggle from '../components/catalog/SafeModeToggle.astro';
import FooterNav from '../components/catalog/FooterNav.astro';
import { sortCollectionsByOrder, type CollectionData } from '../lib/collections';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  canonicalUrl?: string;
}

const { title, description, ogImage, canonicalUrl } = Astro.props;

// Get collections for footer
const collectionsEntries = await getCollection('collections');
const collections: CollectionData[] = sortCollectionsByOrder(
  collectionsEntries.map(entry => ({
    slug: entry.slug,
    ...entry.data
  }))
);
const siteUrl = Astro.site?.toString() || 'https://ai-catalog.ru';
const fullCanonicalUrl = canonicalUrl || new URL(Astro.url.pathname, siteUrl).toString();
const fullOgImage = ogImage ? new URL(ogImage, siteUrl).toString() : `${siteUrl}/images/og-default.jpg`;
---

<BaseLayout title={`${title} | AI Catalog CIS`}>
  <Fragment slot="head">
    <meta name="description" content={description || '–ö–∞—Ç–∞–ª–æ–≥ AI-—Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è —Ä–æ–ª–µ–ø–ª–µ—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞'} />
    <link rel="canonical" href={fullCanonicalUrl} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description || '–ö–∞—Ç–∞–ª–æ–≥ AI-—Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è —Ä–æ–ª–µ–ø–ª–µ—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞'} />
    <meta property="og:image" content={fullOgImage} />
    <meta property="og:url" content={fullCanonicalUrl} />
    <meta property="og:locale" content="ru_RU" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description || '–ö–∞—Ç–∞–ª–æ–≥ AI-—Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è —Ä–æ–ª–µ–ø–ª–µ—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞'} />
    <meta name="twitter:image" content={fullOgImage} />

    <!-- Hreflang -->
    <link rel="alternate" hreflang="ru-RU" href={fullCanonicalUrl} />
    <link rel="alternate" hreflang="x-default" href={fullCanonicalUrl} />

    <!-- Pagefind -->
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
  </Fragment>

  <header slot="header" class="catalog-header">
    <Wrapper>
      <div class="catalog-header__inner">
        <a href="/" class="catalog-header__logo">
          <span class="catalog-header__logo-icon">ü§ñ</span>
          <span class="catalog-header__logo-text">AI Catalog</span>
        </a>
        <nav class="catalog-header__nav">
          <a href="/">–ö–∞—Ç–∞–ª–æ–≥</a>
          <a href="/telegram-bots">Telegram –±–æ—Ç—ã</a>
        </nav>
        <SafeModeToggle />
      </div>
    </Wrapper>
  </header>

  <Wrapper>
    <Space size="M" />
    <slot />
    <Space size="L" />
  </Wrapper>

  <footer slot="footer" class="catalog-footer">
    <Wrapper>
      <FooterNav collections={collections} />
      <p class="catalog-footer__disclaimer">
        –°–∞–π—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã 18+. –ò—Å–ø–æ–ª—å–∑—É—è —Å–∞–π—Ç, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —Å–≤–æ—ë —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–∏–µ.
      </p>
    </Wrapper>
  </footer>
</BaseLayout>

<style>
  .catalog-header {
    padding: calc(var(--ids__density) * 0.5em) 0;
    border-bottom: 1px solid rgba(var(--ids__text-RGB), 0.1);
  }

  .catalog-header__inner {
    display: flex;
    align-items: center;
    gap: calc(var(--ids__density) * 1em);
  }

  .catalog-header__logo {
    display: flex;
    align-items: center;
    gap: 0.4em;
    text-decoration: none;
    color: rgb(var(--ids__text-RGB));
    font-weight: 600;
    font-size: 1.2em;
  }

  .catalog-header__logo:hover {
    color: rgb(var(--ids__hover-RGB));
  }

  .catalog-header__logo-icon {
    font-size: 1.3em;
  }

  .catalog-header__nav {
    display: flex;
    gap: calc(var(--ids__density) * 0.8em);
    flex: 1;
  }

  .catalog-header__nav a {
    color: rgb(var(--ids__link-RGB));
    text-decoration: none;
    transition: color 0.2s;
  }

  .catalog-header__nav a:hover {
    color: rgb(var(--ids__hover-RGB));
  }

  .catalog-footer {
    padding: calc(var(--ids__density) * 1em) 0;
    border-top: 1px solid rgba(var(--ids__text-RGB), 0.1);
    text-align: center;
    font-size: 0.9em;
  }

  .catalog-footer__disclaimer {
    font-size: 0.85em;
    margin-top: calc(var(--ids__density) * 0.3em);
    opacity: 0.7;
  }

  @media (max-width: 767px) {
    .catalog-header__inner {
      flex-wrap: wrap;
      gap: calc(var(--ids__density) * 0.5em);
    }

    .catalog-header__nav {
      order: 3;
      width: 100%;
      justify-content: center;
    }

    .catalog-header__logo-text {
      display: none;
    }
  }
</style>
