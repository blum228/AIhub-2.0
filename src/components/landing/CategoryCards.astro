---
/**
 * Секция категорий для landing page
 */
import { getCollection } from 'astro:content';
import CategoryCard from '../catalog/CategoryCard.astro';
import { sortCollectionsByOrder, getToolCountForCollection, type CollectionData } from '../../lib/collections';
import type { ToolData } from '../../lib/types';

interface Props {
  title?: string;
}

const { title = 'Подборки' } = Astro.props;

const collectionsEntries = await getCollection('collections');
const collections: CollectionData[] = sortCollectionsByOrder(
  collectionsEntries.map(entry => ({
    slug: entry.slug,
    ...entry.data
  }))
);

const toolsCollection = await getCollection('tools');
const tools: ToolData[] = toolsCollection.map(entry => ({
  slug: entry.slug,
  ...entry.data
}));
---

{collections.length > 0 && (
  <section class="collections">
    {title && <h2 class="collections__title">{title}</h2>}
    <div class="collections__grid">
      {collections.map((col, index) => (
        <CategoryCard
          slug={col.slug}
          title={col.title}
          description={col.description}
          icon={col.icon}
          toolCount={getToolCountForCollection(tools, col)}
          index={index}
        />
      ))}
    </div>
  </section>
)}

<style>
  .collections__title {
    font-size: 2em;
    font-weight: 700;
    margin: 0 0 26px;
    letter-spacing: -0.02em;
  }
  
  .collections__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5em;
  }
  
  @media (max-width: 767px) {
    .collections__grid {
      grid-template-columns: 1fr;
      gap: 1em;
    }
  }
</style>
