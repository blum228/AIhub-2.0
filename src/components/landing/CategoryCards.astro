---
/**
 * Секция категорий для landing page
 * Requirements: 1.3
 */
import { getCollection } from 'astro:content';
import Sequence from '../Sequence.astro';
import SequenceItem from '../SequenceItem.astro';
import CategoryCard from '../catalog/CategoryCard.astro';
import { sortCollectionsByOrder, getToolCountForCollection, type CollectionData } from '../../lib/collections';
import type { ToolData } from '../../lib/types';

interface Props {
  title?: string;
}

const { title = 'Категории' } = Astro.props;

// Получаем все коллекции
const collectionsEntries = await getCollection('collections');
const collections: CollectionData[] = sortCollectionsByOrder(
  collectionsEntries.map(entry => ({
    slug: entry.slug,
    ...entry.data
  }))
);

// Получаем инструменты для подсчёта
const toolsCollection = await getCollection('tools');
const tools: ToolData[] = toolsCollection.map(entry => ({
  slug: entry.slug,
  ...entry.data
}));
---

{collections.length > 0 && (
  <section class="category-cards">
    <h2 class="category-cards__title">{title}</h2>
    <Sequence size="L" gap="M">
      {collections.map(col => (
        <SequenceItem>
          <CategoryCard
            slug={col.slug}
            title={col.title}
            description={col.description}
            icon={col.icon}
            toolCount={getToolCountForCollection(tools, col)}
          />
        </SequenceItem>
      ))}
    </Sequence>
  </section>
)}

<style>
  .category-cards__title {
    text-align: left;
  }
</style>
