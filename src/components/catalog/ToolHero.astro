---
/**
 * ToolHero - Hero section for tool page
 * Displays cover image, title, description, rating, price, badges, and CTA
 * Requirements: 1.1, 1.2, 1.3, 1.4
 */
import Rounded from '../Rounded.astro';
import Button from '../Button.astro';
import type { ToolData } from '../../lib/types';
import { PRICE_MODEL_LABELS } from '../../lib/types';

interface Props {
  tool: ToolData;
}

const { tool } = Astro.props;

const priceDisplay = tool.priceModel === 'free' 
  ? 'Бесплатно' 
  : tool.priceFrom 
    ? `от $${tool.priceFrom}/мес` 
    : PRICE_MODEL_LABELS[tool.priceModel];

const isTelegramBot = tool.tags.includes('telegram-bot');

// Generate star rating display
function renderStars(rating: number): string {
  const fullStars = Math.floor(rating);
  const hasHalf = rating - fullStars >= 0.5;
  let stars = '★'.repeat(fullStars);
  if (hasHalf) stars += '½';
  return stars;
}
---

<div class="tool-hero">
  <div class="tool-hero__media">
    <Rounded>
      <img 
        src={tool.coverImage} 
        alt={tool.title} 
        class:list={['tool-hero__img', { 'nsfw': tool.isNsfw }]} 
        loading="eager"
      />
    </Rounded>
  </div>
  
  <div class="tool-hero__body">
    <h1 class="tool-hero__title">{tool.title}</h1>
    <p class="tool-hero__desc">{tool.shortDescription}</p>
    
    <div class="tool-hero__meta">
      {tool.rating && (
        <span class="tool-hero__rating" title={`Рейтинг: ${tool.rating.toFixed(1)}`}>
          <span class="tool-hero__stars">{renderStars(tool.rating)}</span>
          <span class="tool-hero__rating-value">{tool.rating.toFixed(1)}</span>
        </span>
      )}
      <span class="tool-hero__price">{priceDisplay}</span>
    </div>
    
    <div class="tool-hero__badges">
      {!tool.requiresVpn && (
        <span class="badge badge--success">Без VPN</span>
      )}
      {tool.requiresVpn && (
        <span class="badge badge--warning">Нужен VPN</span>
      )}
      {tool.acceptsRussianCards && (
        <span class="badge badge--success">Карты РФ</span>
      )}
      {!tool.acceptsRussianCards && (
        <span class="badge badge--warning">Нет карт РФ</span>
      )}
      {tool.supportsRussian && (
        <span class="badge badge--info">Русский</span>
      )}
    </div>
    
    <div class="tool-hero__cta">
      <Button href={tool.affiliateLink} variant="primary" size="L">
        Открыть сервис
      </Button>
      {isTelegramBot && tool.telegramBotLink && (
        <Button href={tool.telegramBotLink} variant="secondary" size="L">
          Telegram
        </Button>
      )}
    </div>
  </div>
</div>

<style>
  .tool-hero {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-top: 1.5rem;
  }

  @media (max-width: 768px) {
    .tool-hero {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }

  .tool-hero__img {
    width: 100%;
    aspect-ratio: 16/10;
    object-fit: cover;
    display: block;
  }

  :global(.safe-mode) .nsfw {
    filter: blur(20px);
  }

  .tool-hero__body {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tool-hero__title {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.1;
    margin: 0;
  }

  @media (max-width: 768px) {
    .tool-hero__title {
      font-size: 2rem;
    }
  }

  .tool-hero__desc {
    font-size: 1.125rem;
    line-height: 1.5;
    color: rgba(var(--ids__text-RGB), 0.7);
    margin: 0;
  }

  .tool-hero__meta {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .tool-hero__rating {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-weight: 600;
  }

  .tool-hero__stars {
    color: rgb(var(--ids__warning-RGB));
    font-size: 1rem;
  }

  .tool-hero__rating-value {
    font-size: 0.9375rem;
    color: rgba(var(--ids__text-RGB), 0.8);
  }

  .tool-hero__price {
    font-size: 0.9375rem;
    font-weight: 600;
    padding: 0.25rem 0.625rem;
    background: rgb(var(--ids__surface-RGB));
    border-radius: 0.25rem;
  }

  .tool-hero__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .badge {
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
  }

  .badge--success {
    background: rgba(var(--ids__success-RGB), 0.12);
    color: rgb(var(--ids__success-RGB));
  }

  .badge--warning {
    background: rgba(var(--ids__warning-RGB), 0.12);
    color: rgb(var(--ids__warning-RGB));
  }

  .badge--info {
    background: rgba(var(--ids__info-RGB), 0.12);
    color: rgb(var(--ids__info-RGB));
  }

  .tool-hero__cta {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.5rem;
  }
</style>
