---
/**
 * –¢–æ–ø-3 —Å–µ—Ä–≤–∏—Å–∞ —Å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º
 * SEO: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
 */
import Rounded from '../Rounded.astro';
import type { ToolData } from '../../lib/types';

interface Props {
  tools: ToolData[];
  title?: string;
}

const { tools, title = '–¢–æ–ø AI-—Å–µ—Ä–≤–∏—Å–æ–≤' } = Astro.props;

// –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-3
const topTools = tools.slice(0, 3);

// –ú–µ–¥–∞–ª–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π
const medals = ['ü•á', 'ü•à', 'ü•â'];
const rankColors = [
  'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
  'linear-gradient(135deg, #E8E8E8 0%, #B8B8B8 100%)',
  'linear-gradient(135deg, #CD7F32 0%, #8B4513 100%)'
];
---

<section class="top-services">
  <h2 class="top-services__title">{title}</h2>
  
  <div class="top-services__grid">
    {topTools.map((tool, index) => (
      <article class:list={['top-card', `top-card--rank-${index + 1}`]}>
        <a href={`/tool/${tool.slug}`} class="top-card__link">
          <div class="top-card__rank" style={`background: ${rankColors[index]}`}>
            <span class="top-card__medal">{medals[index]}</span>
            <span class="top-card__position">#{index + 1}</span>
          </div>
          
          <Rounded class="top-card__image-wrapper">
            <img
              src={tool.coverImage}
              alt={tool.title}
              class:list={['top-card__image', { 'nsfw-image': tool.isNsfw }]}
              loading={index === 0 ? 'eager' : 'lazy'}
            />
          </Rounded>
          
          <div class="top-card__content">
            <h3 class="top-card__title">{tool.title}</h3>
            
            {tool.rating !== undefined && (
              <div class="top-card__rating">
                <span class="top-card__stars">{'‚òÖ'.repeat(Math.floor(tool.rating))}{'‚òÜ'.repeat(5 - Math.floor(tool.rating))}</span>
                <span class="top-card__rating-value">{tool.rating.toFixed(1)}</span>
              </div>
            )}
            
            <p class="top-card__description">{tool.shortDescription}</p>
            
            <div class="top-card__badges">
              {tool.acceptsRussianCards && <span class="top-card__badge top-card__badge--success">üí≥ –ö–∞—Ä—Ç—ã –†–§</span>}
              {!tool.requiresVpn && <span class="top-card__badge top-card__badge--success">‚úì –ë–µ–∑ VPN</span>}
              {tool.supportsRussian && <span class="top-card__badge">üá∑üá∫ –†—É—Å—Å–∫–∏–π</span>}
            </div>
            
            <div class="top-card__price">
              {tool.priceModel === 'free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : tool.priceFrom ? `–æ—Ç ${tool.priceFrom}$` : '–ü–ª–∞—Ç–Ω–æ'}
            </div>
          </div>
        </a>
      </article>
    ))}
  </div>
</section>


<style>
  .top-services {
    /* –æ—Ç—Å—Ç—É–ø—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Space */
  }

  .top-services__title {
    margin-bottom: 1em;
    font-size: 1.5em;
  }

  .top-services__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5em;
  }

  @media (max-width: 900px) {
    .top-services__grid {
      grid-template-columns: 1fr;
      gap: 1em;
    }
  }

  .top-card {
    position: relative;
    background: rgb(var(--ids__surface-RGB));
    border-radius: var(--ids__radius, 12px);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .top-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .top-card--rank-1 {
    border: 2px solid rgba(255, 215, 0, 0.4);
  }

  .top-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .top-card__rank {
    position: absolute;
    top: 1em;
    left: 1em;
    z-index: 10;
    display: flex;
    align-items: center;
    gap: 0.3em;
    padding: 0.4em 0.8em;
    border-radius: 2em;
    color: white;
    font-weight: 700;
    font-size: 0.85em;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .top-card__medal {
    font-size: 1.1em;
  }

  .top-card__image-wrapper {
    aspect-ratio: 16 / 9;
    overflow: hidden;
  }

  .top-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .top-card:hover .top-card__image {
    transform: scale(1.05);
  }

  :global(.safe-mode) .nsfw-image {
    filter: blur(20px);
  }

  .top-card__content {
    padding: 1.25em;
  }

  .top-card__title {
    font-size: 1.2em;
    font-weight: 700;
    margin: 0 0 0.5em;
    color: rgb(var(--ids__text-RGB));
  }

  .top-card__rating {
    display: flex;
    align-items: center;
    gap: 0.5em;
    margin-bottom: 0.5em;
  }

  .top-card__stars {
    color: #f59e0b;
    font-size: 1em;
    letter-spacing: -0.02em;
  }

  .top-card__rating-value {
    font-weight: 700;
    font-size: 0.95em;
    color: rgba(var(--ids__text-RGB), 0.8);
  }

  .top-card__description {
    font-size: 0.9em;
    color: rgba(var(--ids__text-RGB), 0.7);
    line-height: 1.5;
    margin: 0 0 0.75em;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .top-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4em;
    margin-bottom: 0.75em;
  }

  .top-card__badge {
    font-size: 0.75em;
    padding: 0.3em 0.6em;
    background: rgba(var(--ids__text-RGB), 0.08);
    border-radius: 1em;
    color: rgba(var(--ids__text-RGB), 0.7);
  }

  .top-card__badge--success {
    background: rgba(34, 197, 94, 0.15);
    color: #16a34a;
  }

  .top-card__price {
    font-weight: 600;
    font-size: 0.95em;
    color: rgb(var(--ids__text-RGB));
  }
</style>
