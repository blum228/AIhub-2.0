---
interface Props {
  defaultEnabled?: boolean;
}

const { defaultEnabled = false } = Astro.props;
---

<button
  type="button"
  class="safe-mode-toggle"
  id="safe-mode-toggle"
  aria-pressed={defaultEnabled}
  title="Безопасный режим (размытие NSFW)"
>
  <svg class="safe-mode-toggle__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
    <circle cx="12" cy="12" r="3"/>
  </svg>
</button>

<style>
  .safe-mode-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2em;
    height: 2em;
    padding: 0;
    border: 1px solid rgba(var(--ids__text-RGB), 0.2);
    border-radius: var(--ids__radius, 0.3em);
    background: transparent;
    cursor: pointer;
    transition: all 0.5s ease;
    color: rgba(var(--ids__text-RGB), 0.4);
  }

  .safe-mode-toggle:hover {
    color: rgb(var(--ids__text-RGB));
    border-color: rgba(var(--ids__text-RGB), 0.5);
    transition: all 0s ease;
  }

  .safe-mode-toggle[aria-pressed="true"] {
    color: rgb(var(--ids__link-RGB));
    border-color: rgb(var(--ids__link-RGB));
    background: rgba(var(--ids__link-RGB), 0.1);
  }

  .safe-mode-toggle[aria-pressed="true"]:hover {
    color: rgb(var(--ids__hover-RGB));
    border-color: rgb(var(--ids__hover-RGB));
  }

  .safe-mode-toggle__icon {
    width: 1em;
    height: 1em;
  }
</style>

<script>
  const SAFE_MODE_KEY = 'safeMode';
  const toggle = document.getElementById('safe-mode-toggle');

  function setSafeMode(enabled: boolean) {
    localStorage.setItem(SAFE_MODE_KEY, JSON.stringify(enabled));
    document.body.classList.toggle('safe-mode', enabled);
    toggle?.setAttribute('aria-pressed', String(enabled));
  }

  function getSafeMode(): boolean {
    const stored = localStorage.getItem(SAFE_MODE_KEY);
    return stored ? JSON.parse(stored) : false;
  }

  // Инициализация
  const initialState = getSafeMode();
  setSafeMode(initialState);

  // Обработчик клика
  toggle?.addEventListener('click', () => {
    const current = getSafeMode();
    setSafeMode(!current);
  });
</script>
