---
import { getCollection } from 'astro:content';
import CatalogLayout from '../../layouts/CatalogLayout.astro';
import SearchWidget from '../../components/catalog/SearchWidget.astro';
import TagFilter from '../../components/catalog/TagFilter.astro';
import ToolGrid from '../../components/catalog/ToolGrid.astro';
import Space from '../../components/Space.astro';
import TextWidth from '../../components/TextWidth.astro';
import { sortToolsByRating } from '../../lib/tools';
import type { ToolData } from '../../lib/types';

// Получаем все инструменты
const toolsCollection = await getCollection('tools');

// Преобразуем в ToolData
const tools: ToolData[] = toolsCollection.map(entry => ({
  slug: entry.slug,
  ...entry.data
}));

// Сортируем по рейтингу
const sortedTools = sortToolsByRating(tools);
---

<CatalogLayout
  title="Каталог AI-сервисов"
  description="Лучшие AI-сервисы для ролеплея и генерации контента 18+. Фильтры по оплате, языку и доступности из России."
>
  <!-- Hero -->
  <TextWidth>
    <Space size="XL" />
    <h1 class="S">AI Каталог для СНГ</h1>
    <p class="loud">
      Лучшие AI-сервисы для ролеплея и генерации контента.<br />
      Фильтры по оплате картами РФ, поддержке русского языка и доступности без VPN.
    </p>
    <SearchWidget placeholder="Поиск по названию или описанию..." />
  </TextWidth>

  <Space size="L" />

  <!-- Фильтры -->
  <TagFilter />

  <Space size="M" />

  <!-- Основная сетка -->
  <ToolGrid tools={sortedTools} />


</CatalogLayout>
